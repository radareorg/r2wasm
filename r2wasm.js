var r2wasm=(()=>{var y=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames,R=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var O=(e,t,n)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,X=(e,t)=>{for(var n in t||(t={}))U.call(t,n)&&O(e,n,t[n]);if(R)for(var n of R(t))Z.call(t,n)&&O(e,n,t[n]);return e};var tt=(e,t)=>{for(var n in t)y(e,n,{get:t[n],enumerable:!0})},et=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of V(t))!U.call(e,s)&&s!==n&&y(e,s,{get:()=>t[s],enumerable:!(r=Q(t,s))||r.enumerable});return e};var nt=e=>et(y({},"__esModule",{value:!0}),e);var yt={};tt(yt,{cancel:()=>wt,init_async:()=>Y,reset_any:()=>pt,run:()=>C,run_any:()=>gt,run_js:()=>mt,run_r2:()=>ht});var z={fg:"#FFF",bg:"#000",newline:!1,escapeXML:!1,stream:!1,colors:rt()};function rt(){let e={0:"#000",1:"#A00",2:"#0A0",3:"#A50",4:"#00A",5:"#A0A",6:"#0AA",7:"#AAA",8:"#555",9:"#F55",10:"#5F5",11:"#FF5",12:"#55F",13:"#F5F",14:"#5FF",15:"#FFF"};return x(0,5).forEach(t=>{x(0,5).forEach(n=>{x(0,5).forEach(r=>st(t,n,r,e))})}),x(0,23).forEach(function(t){let n=t+232,r=K(t*10+8);e[n]="#"+r+r+r}),e}function st(e,t,n,r){let s=16+e*36+t*6+n,o=e>0?e*40+55:0,c=t>0?t*40+55:0,u=n>0?n*40+55:0;r[s]=ot([o,c,u])}function K(e){let t=e.toString(16);for(;t.length<2;)t="0"+t;return t}function ot(e){let t=[];for(let n of e)t.push(K(n));return"#"+t.join("")}function k(e,t,n,r){let s;return t==="text"?s=at(n,r):t==="display"?s=lt(e,n,r):t==="xterm256Foreground"?s=E(e,r.colors[n]):t==="xterm256Background"?s=F(e,r.colors[n]):t==="rgb"&&(s=it(e,n)),s}function it(e,t){t=t.substring(2).slice(0,-1);let n=+t.substr(0,2),s=t.substring(5).split(";").map(function(o){return("0"+Number(o).toString(16)).substr(-2)}).join("");return v(e,(n===38?"color:#":"background-color:#")+s)}function lt(e,t,n){t=parseInt(t,10);let r={"-1":()=>"<br/>",0:()=>e.length&&W(e),1:()=>d(e,"b"),3:()=>d(e,"i"),4:()=>d(e,"u"),8:()=>v(e,"display:none"),9:()=>d(e,"strike"),22:()=>v(e,"font-weight:normal;text-decoration:none;font-style:normal"),23:()=>$(e,"i"),24:()=>$(e,"u"),39:()=>E(e,n.fg),49:()=>F(e,n.bg),53:()=>v(e,"text-decoration:overline")},s;return r[t]?s=r[t]():4<t&&t<7?s=d(e,"blink"):29<t&&t<38?s=E(e,n.colors[t-30]):39<t&&t<48?s=F(e,n.colors[t-40]):89<t&&t<98?s=E(e,n.colors[8+(t-90)]):99<t&&t<108&&(s=F(e,n.colors[8+(t-100)])),s}function W(e){let t=e.slice(0);return e.length=0,t.reverse().map(function(n){return"</"+n+">"}).join("")}function x(e,t){let n=[];for(let r=e;r<=t;r++)n.push(r);return n}function ct(e){return function(t){return(e===null||t.category!==e)&&e!=="all"}}function P(e){e=parseInt(e,10);let t=null;return e===0?t="all":e===1?t="bold":2<e&&e<5?t="underline":4<e&&e<7?t="blink":e===8?t="hide":e===9?t="strike":29<e&&e<38||e===39||89<e&&e<98?t="foreground-color":(39<e&&e<48||e===49||99<e&&e<108)&&(t="background-color"),t}function at(e,t){return t.escapeXML?entities.encodeXML(e):e}function d(e,t,n){return n||(n=""),e.push(t),`<${t}${n?` style="${n}"`:""}>`}function v(e,t){return d(e,"span",t)}function E(e,t){return d(e,"span","color:"+t)}function F(e,t){return d(e,"span","background-color:"+t)}function $(e,t){let n;if(e.slice(-1)[0]===t&&(n=e.pop()),n)return"</"+t+">"}function ut(e,t,n){let r=!1,s=3;function o(){return""}function c(i,l){return n("xterm256Foreground",l),""}function u(i,l){return n("xterm256Background",l),""}function p(i){return t.newline?n("display",-1):n("text",i),""}function D(i,l){r=!0,l.trim().length===0&&(l="0"),l=l.trimRight(";").split(";");for(let h of l)n("display",h);return""}function g(i){return n("text",i),""}function b(i){return n("rgb",i),""}let m=[{pattern:/^\x08+/,sub:o},{pattern:/^\x1b\[[012]?K/,sub:o},{pattern:/^\x1b\[\(B/,sub:o},{pattern:/^\x1b\[[34]8;2;\d+;\d+;\d+m/,sub:b},{pattern:/^\x1b\[38;5;(\d+)m/,sub:c},{pattern:/^\x1b\[48;5;(\d+)m/,sub:u},{pattern:/^\n/,sub:p},{pattern:/^\r+\n/,sub:p},{pattern:/^\r/,sub:p},{pattern:/^\x1b\[((?:\d{1,3};?)+|)m/,sub:D},{pattern:/^\x1b\[\d?J/,sub:o},{pattern:/^\x1b\[\d{0,3};\d{0,3}f/,sub:o},{pattern:/^\x1b\[?[\d;]{0,3}/,sub:o},{pattern:/^(([^\x1b\x08\r\n])+)/,sub:g}];function a(i,l){l>s&&r||(r=!1,e=e.replace(i.pattern,i.sub))}let w=[],{length:f}=e;t:for(;f>0;){for(let i=0,l=0,h=m.length;l<h;i=++l){let S=m[i];if(a(S,i),e.length!==f){f=e.length;continue t}}if(e.length===f)break;w.push(0),f=e.length}return w}function ft(e,t,n){return t!=="text"&&(e=e.filter(ct(P(n))),e.push({token:t,data:n,category:P(n)})),e}var _=class{constructor(t){t=t||{},t.colors&&(t.colors=Object.assign({},z.colors,t.colors)),this.options=Object.assign({},z,t),this.stack=[],this.stickyStack=[]}toHtml(t){t=typeof t=="string"?[t]:t;let{stack:n,options:r}=this,s=[];return this.stickyStack.forEach(o=>{let c=k(n,o.token,o.data,r);c&&s.push(c)}),ut(t.join(""),r,(o,c)=>{let u=k(n,o,c,r);u&&s.push(u),r.stream&&(this.stickyStack=ft(this.stickyStack,o,c))}),n.length&&s.push(W(n)),s.join("")}};function q(e){let t=!1,n=[],r=null,s=null,o=null,c=async(g,b)=>{p(),o||(o=new AbortController);let m=o.signal;t=!0;try{let a=await fetch(e+g,X({signal:m},b));if(a.status>=200&&a.status<300)return r=await u(a),r;throw new Error(a.statusText)}catch(a){return s=a,r=null,s}finally{t=!1}},u=async g=>{let b=g.body.getReader(),m=+g.headers.get("content-length"),a=0;for(;t;){let{done:i,value:l}=await b.read(),h={detail:{received:a,length:m,loading:t}},S=new CustomEvent("fetch-progress",h),G=new CustomEvent("fetch-finished",h);i?(t=!1,window.dispatchEvent(G)):(n.push(l),a+=l.length,window.dispatchEvent(S))}let w=new Uint8Array(a),f=0;for(let i of n)w.set(i,f),f+=i.length;return t=!1,w},p=()=>{t=!1,n=[],r=null,s=null,o=new AbortController};return{get:c,cancel:()=>{p(),o&&o.abort()}}}var B=1,I=class extends HTMLElement{connectedCallback(){B++,this.id="r2id"+B;let t=this.getAttribute("language"),n=this.getAttribute("script"),r=n?n.replace("\\n",`
`):"",s=`
  <div style="background-color:#808080;border-radius:5px;box-sizing:border-box;padding:5px">
  <textarea id="script-`+this.id+'" style="font-family:monospace;background-color:black;color:white;box-sizing:border-box;width:98%;padding:5px;height:6em;margin:5px;border-radius:5px;resize:none">'+r+`</textarea>
  <div id="orig-`+this.id+'" style="visibility:hidden">'+r+`</div>
  <div style="text-align:left; margin:5px">
  <button onclick="r2wasm.run_any('`+this.id+"', '"+t+`')">Run</button>
  <button onclick="r2wasm.reset_any('`+this.id+`')">Reset</button>
  </div>
<div id="shell-`+this.id+`" style="overflow:scroll;margin:5px;display:block;background-color:black;border-radius:5px;color:white;white-space:pre;font-family:monospace"></div>
  </div>
   `,c=new DOMParser().parseFromString(s,"text/html");c.body.firstChild&&this.appendChild(c.body.firstChild)}constructor(){super();let t=document.createElement("div");t.style.padding="10px"}};window.customElements.define("r2-wasm",I);var L=class extends HTMLElement{connectedCallback(){B++,this.id="r2-wasm-progress";let r=new DOMParser().parseFromString("","text/html");r.body.firstChild&&this.appendChild(r.body.firstChild)}constructor(){super();let t=document.createElement("div");t.style.padding="10px"}};window.customElements.define("r2-wasm-progress",L);var{WASI:dt}=window.Runno,J="/script.r2",j="",H="";function pt(e){let t=document.getElementById("shell-"+e);t.innerHTML="";let n=document.getElementById("orig-"+e),r=document.getElementById("script-"+e);r.value=n.innerHTML}function gt(e,t){let n=document.getElementById("shell-"+e),r=document.getElementById("script-"+e);C(e,t,r.value)}function mt(){J="/script.r2.js",j=document.getElementById("script").value,div=document.getElementById("shell"),C()}function ht(){J="/script.r2",H=document.getElementById("script").value,div=document.getElementById("shell"),C()}var bt=new _,A=null;var M=!1;function N(){if(M)return;M=!0,A=fetch("radare2.wasm?v=5.8.8"),T({received:100,length:100,loading:!1}),M=!1}function wt(){r2wasm_cancel_async();let e=document.getElementById("r2-wasm-progress"),t="";e.innerHTML=t}async function Y(){try{let{get:e,cancel:t}=q("./");r2wasm_cancel_async=t,window.addEventListener("fetch-progress",n=>{T(n.detail)}),window.addEventListener("fetch-finished",n=>{T({received:100,length:100,loading:!1})}),A=await e("radare2.wasm?v=5.8.8")}catch(e){console.error(e)}return N(),!0}function T(e){let t=0|e.received*100/e.length,n=document.getElementById("r2-wasm-progress");t===100?n.innerHTML="":n.innerHTML="<button onclick='r2wasm.cancel()'>cancel</button> <div style='border:2px solid black;background-color:grey;width:"+t+"px'> r2wasm("+t+"%)</div>"}async function C(e,t,n){A==null&&await Y(),div=document.getElementById("shell-"+e),div.innerHTML="",H=n,j=n;let r=t==="r2js"?"/script.r2.js":"/script.r2",s=dt.start(A,{args:["radare2","-qi",r,"some-file.txt"],env:{SOME_KEY:"some value"},stdout:o=>{div.innerHTML+=bt.toHtml(o)},stderr:o=>{console.error("stderr",o),div.innerHTML+=out},fs:{"/script.r2":{path:"/script.r2",timestamps:{access:new Date,change:new Date,modification:new Date},mode:"string",content:H},"/script.r2.js":{path:"/script.r2.js",timestamps:{access:new Date,change:new Date,modification:new Date},mode:"string",content:j},"/some-file.txt":{path:"/some-file.txt",timestamps:{access:new Date,change:new Date,modification:new Date},mode:"string",content:"Some content for the file."}}});N()}return nt(yt);})();
