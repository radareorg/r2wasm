var r2wasm=(()=>{var y=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames,D=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var R=(e,t,n)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,k=(e,t)=>{for(var n in t||(t={}))O.call(t,n)&&R(e,n,t[n]);if(D)for(var n of D(t))G.call(t,n)&&R(e,n,t[n]);return e};var Q=(e,t)=>{for(var n in t)y(e,n,{get:t[n],enumerable:!0})},V=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Y(t))!O.call(e,s)&&s!==n&&y(e,s,{get:()=>t[s],enumerable:!(r=N(t,s))||r.enumerable});return e};var Z=e=>V(y({},"__esModule",{value:!0}),e);var bt={};Q(bt,{r2wasm_init_async:()=>ht,run_any:()=>dt,run_js:()=>mt,run_r2:()=>pt});var U={fg:"#FFF",bg:"#000",newline:!1,escapeXML:!1,stream:!1,colors:tt()};function tt(){let e={0:"#000",1:"#A00",2:"#0A0",3:"#A50",4:"#00A",5:"#A0A",6:"#0AA",7:"#AAA",8:"#555",9:"#F55",10:"#5F5",11:"#FF5",12:"#55F",13:"#F5F",14:"#5FF",15:"#FFF"};return v(0,5).forEach(t=>{v(0,5).forEach(n=>{v(0,5).forEach(r=>et(t,n,r,e))})}),v(0,23).forEach(function(t){let n=t+232,r=W(t*10+8);e[n]="#"+r+r+r}),e}function et(e,t,n,r){let s=16+e*36+t*6+n,i=e>0?e*40+55:0,c=t>0?t*40+55:0,u=n>0?n*40+55:0;r[s]=nt([i,c,u])}function W(e){let t=e.toString(16);for(;t.length<2;)t="0"+t;return t}function nt(e){let t=[];for(let n of e)t.push(W(n));return"#"+t.join("")}function X(e,t,n,r){let s;return t==="text"?s=ot(n,r):t==="display"?s=st(e,n,r):t==="xterm256Foreground"?s=_(e,r.colors[n]):t==="xterm256Background"?s=E(e,r.colors[n]):t==="rgb"&&(s=rt(e,n)),s}function rt(e,t){t=t.substring(2).slice(0,-1);let n=+t.substr(0,2),s=t.substring(5).split(";").map(function(i){return("0"+Number(i).toString(16)).substr(-2)}).join("");return x(e,(n===38?"color:#":"background-color:#")+s)}function st(e,t,n){t=parseInt(t,10);let r={"-1":()=>"<br/>",0:()=>e.length&&$(e),1:()=>d(e,"b"),3:()=>d(e,"i"),4:()=>d(e,"u"),8:()=>x(e,"display:none"),9:()=>d(e,"strike"),22:()=>x(e,"font-weight:normal;text-decoration:none;font-style:normal"),23:()=>P(e,"i"),24:()=>P(e,"u"),39:()=>_(e,n.fg),49:()=>E(e,n.bg),53:()=>x(e,"text-decoration:overline")},s;return r[t]?s=r[t]():4<t&&t<7?s=d(e,"blink"):29<t&&t<38?s=_(e,n.colors[t-30]):39<t&&t<48?s=E(e,n.colors[t-40]):89<t&&t<98?s=_(e,n.colors[8+(t-90)]):99<t&&t<108&&(s=E(e,n.colors[8+(t-100)])),s}function $(e){let t=e.slice(0);return e.length=0,t.reverse().map(function(n){return"</"+n+">"}).join("")}function v(e,t){let n=[];for(let r=e;r<=t;r++)n.push(r);return n}function it(e){return function(t){return(e===null||t.category!==e)&&e!=="all"}}function z(e){e=parseInt(e,10);let t=null;return e===0?t="all":e===1?t="bold":2<e&&e<5?t="underline":4<e&&e<7?t="blink":e===8?t="hide":e===9?t="strike":29<e&&e<38||e===39||89<e&&e<98?t="foreground-color":(39<e&&e<48||e===49||99<e&&e<108)&&(t="background-color"),t}function ot(e,t){return t.escapeXML?entities.encodeXML(e):e}function d(e,t,n){return n||(n=""),e.push(t),`<${t}${n?` style="${n}"`:""}>`}function x(e,t){return d(e,"span",t)}function _(e,t){return d(e,"span","color:"+t)}function E(e,t){return d(e,"span","background-color:"+t)}function P(e,t){let n;if(e.slice(-1)[0]===t&&(n=e.pop()),n)return"</"+t+">"}function lt(e,t,n){let r=!1,s=3;function i(){return""}function c(o,l){return n("xterm256Foreground",l),""}function u(o,l){return n("xterm256Background",l),""}function m(o){return t.newline?n("display",-1):n("text",o),""}function T(o,l){r=!0,l.trim().length===0&&(l="0"),l=l.trimRight(";").split(";");for(let h of l)n("display",h);return""}function p(o){return n("text",o),""}function b(o){return n("rgb",o),""}let g=[{pattern:/^\x08+/,sub:i},{pattern:/^\x1b\[[012]?K/,sub:i},{pattern:/^\x1b\[\(B/,sub:i},{pattern:/^\x1b\[[34]8;2;\d+;\d+;\d+m/,sub:b},{pattern:/^\x1b\[38;5;(\d+)m/,sub:c},{pattern:/^\x1b\[48;5;(\d+)m/,sub:u},{pattern:/^\n/,sub:m},{pattern:/^\r+\n/,sub:m},{pattern:/^\r/,sub:m},{pattern:/^\x1b\[((?:\d{1,3};?)+|)m/,sub:T},{pattern:/^\x1b\[\d?J/,sub:i},{pattern:/^\x1b\[\d{0,3};\d{0,3}f/,sub:i},{pattern:/^\x1b\[?[\d;]{0,3}/,sub:i},{pattern:/^(([^\x1b\x08\r\n])+)/,sub:p}];function a(o,l){l>s&&r||(r=!1,e=e.replace(o.pattern,o.sub))}let w=[],{length:f}=e;t:for(;f>0;){for(let o=0,l=0,h=g.length;l<h;o=++l){let C=g[o];if(a(C,o),e.length!==f){f=e.length;continue t}}if(e.length===f)break;w.push(0),f=e.length}return w}function ct(e,t,n){return t!=="text"&&(e=e.filter(it(z(n))),e.push({token:t,data:n,category:z(n)})),e}var A=class{constructor(t){t=t||{},t.colors&&(t.colors=Object.assign({},U.colors,t.colors)),this.options=Object.assign({},U,t),this.stack=[],this.stickyStack=[]}toHtml(t){t=typeof t=="string"?[t]:t;let{stack:n,options:r}=this,s=[];return this.stickyStack.forEach(i=>{let c=X(n,i.token,i.data,r);c&&s.push(c)}),lt(t.join(""),r,(i,c)=>{let u=X(n,i,c,r);u&&s.push(u),r.stream&&(this.stickyStack=ct(this.stickyStack,i,c))}),n.length&&s.push($(n)),s.join("")}};function ut(e){let t=!1,n=[],r=null,s=null,i=null,c=async(p,b)=>{m(),i||(i=new AbortController);let g=i.signal;t=!0;try{let a=await fetch(e+p,k({signal:g},b));if(a.status>=200&&a.status<300)return r=await u(a),r;throw new Error(a.statusText)}catch(a){return s=a,r=null,s}finally{t=!1}},u=async p=>{let b=p.body.getReader(),g=+p.headers.get("content-length"),a=0;for(;t;){let{done:o,value:l}=await b.read(),h={detail:{received:a,length:g,loading:t}},C=new CustomEvent("fetch-progress",h),J=new CustomEvent("fetch-finished",h);o?(t=!1,window.dispatchEvent(J)):(n.push(l),a+=l.length,window.dispatchEvent(C))}let w=new Uint8Array(a),f=0;for(let o of n)w.set(o,f),f+=o.length;return t=!1,w},m=()=>{t=!1,n=[],r=null,s=null,i=new AbortController};return{get:c,cancel:()=>{m(),i&&i.abort()}}}var B=1,M=class extends HTMLElement{connectedCallback(){B++,this.id="r2id"+B;let t=this.getAttribute("language"),n=this.getAttribute("script"),r=n?n.replace("\\n",`
`):"",s=`
  <div style="background-color:#808080;border-radius:5px;box-sizing:border-box;padding:5px">
  <textarea id="script-`+this.id+'" style="font-family:monospace;background-color:black;color:white;box-sizing:border-box;width:98%;padding:5px;height:6em;margin:5px;border-radius:5px;resize:none">'+r+`</textarea>
  <div id="orig-`+this.id+'" style="visibility:hidden">'+r+`</div>
  <div style="text-align:left; margin:5px">
  <button onclick="r2wasm.run_any('`+this.id+"', '"+t+`')">Run</button>
  <button onclick="reset_any('`+this.id+`')">Reset</button>
  </div>
<div id="shell-`+this.id+`" style="overflow:scroll;margin:5px;display:block;background-color:black;border-radius:5px;color:white;white-space:pre;font-family:monospace"></div>
  </div>
   `,c=new DOMParser().parseFromString(s,"text/html");c.body.firstChild&&this.appendChild(c.body.firstChild)}constructor(){super();let t=document.createElement("div");t.style.padding="10px"}};window.customElements.define("r2-wasm",M);var S=class extends HTMLElement{connectedCallback(){B++,this.id="r2-wasm-progress";let r=new DOMParser().parseFromString("<div><button onclick='r2wasm.r2wasm_init_async()'>r2wasm.init()</button></div>","text/html");r.body.firstChild&&this.appendChild(r.body.firstChild)}constructor(){super();let t=document.createElement("div");t.style.padding="10px"}};window.customElements.define("r2-wasm-progress",S);var{WASI:ft}=window.Runno,K="/script.r2",I="",j="";function dt(e,t){let n=document.getElementById("shell-"+e),r=document.getElementById("script-"+e);L(e,t,r.value)}function mt(){K="/script.r2.js",I=document.getElementById("script").value,div=document.getElementById("shell"),L()}function pt(){K="/script.r2",j=document.getElementById("script").value,div=document.getElementById("shell"),L()}var gt=new A;var F=null;function q(){F=fetch("radare2.wasm?v=5.8.8"),H({received:100,length:100,loading:!1})}async function ht(){try{let{get:e,cancel:t}=ut("./");r2wasm_cancel_async=t,window.addEventListener("fetch-progress",n=>{H(n.detail)}),window.addEventListener("fetch-finished",n=>{H({received:100,length:100,loading:!1})}),F=await e("radare2.wasm?v=5.8.8")}catch(e){console.error(e)}return q(),!0}function H(e){let t=0|e.received*100/e.length,n=document.getElementById("r2-wasm-progress");t===100?n.innerHTML="":n.innerHTML="<button onclick='r2wasm_cancel()'>cancel</button> <div style='border:2px solid black;background-color:grey;width:"+t+"px'> r2wasm("+t+"%)</div>"}function L(e,t,n){if(F==null){alert("call r2wasm_init fore r2wasm_run");return}div=document.getElementById("shell-"+e),div.innerHTML="",j=n,I=n;let r=t==="r2js"?"/script.r2.js":"/script.r2",s=ft.start(F,{args:["radare2","-qi",r,"some-file.txt"],env:{SOME_KEY:"some value"},stdout:i=>{div.innerHTML+=gt.toHtml(i)},stderr:i=>{console.error("stderr",i),div.innerHTML+=out},fs:{"/script.r2":{path:"/script.r2",timestamps:{access:new Date,change:new Date,modification:new Date},mode:"string",content:j},"/script.r2.js":{path:"/script.r2.js",timestamps:{access:new Date,change:new Date,modification:new Date},mode:"string",content:I},"/some-file.txt":{path:"/some-file.txt",timestamps:{access:new Date,change:new Date,modification:new Date},mode:"string",content:"Some content for the file."}}});q()}return Z(bt);})();
