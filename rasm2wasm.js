var rasm2wasm=(()=>{var h=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames,B=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var k=(t,e,n)=>e in t?h(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_=(t,e)=>{for(var n in e||(e={}))C.call(e,n)&&k(t,n,e[n]);if(B)for(var n of B(e))z.call(e,n)&&k(t,n,e[n]);return t};var K=(t,e)=>{for(var n in e)h(t,n,{get:e[n],enumerable:!0})},P=(t,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of U(e))!C.call(t,r)&&r!==n&&h(t,r,{get:()=>e[r],enumerable:!(s=O(e,r))||s.enumerable});return t};var Y=t=>P(h({},"__esModule",{value:!0}),t);var N={};K(N,{assemble:()=>G,cancel:()=>j,disassemble:()=>J,init_async:()=>b,listArchs:()=>q,progress:()=>g,reset:()=>W});function S(t){let e=!1,n=[],s=null,r=null,i=null,a=async(m,f)=>{l(),i||(i=new AbortController);let v=i.signal;e=!0;try{let o=await fetch(t+m,_({signal:v},f));if(o.status>=200&&o.status<300)return s=await c(o),s;throw new Error(o.statusText)}catch(o){return r=o,s=null,r}finally{e=!1}},c=async m=>{let f=m.body.getReader(),v=+m.headers.get("content-length"),o=0;for(;e;){let{done:u,value:A}=await f.read(),I={detail:{received:o,length:v,loading:e}},D=new CustomEvent("fetch-progress",I),F=new CustomEvent("fetch-finished",I);u?(e=!1,window.dispatchEvent(F)):(n.push(A),o+=A.length,window.dispatchEvent(D))}let H=new Uint8Array(o),T=0;for(let u of n)H.set(u,T),T+=u.length;return e=!1,H},l=()=>{e=!1,n=[],s=null,r=null,i=new AbortController};return{get:a,cancel:()=>{l(),i&&i.abort()}}}var E=1,x=class extends HTMLElement{connectedCallback(){E++,this.id="rasm2id"+E;let e=this.getAttribute("language"),n=this.getAttribute("arch"),s=this.getAttribute("bits"),r=this.getAttribute("input"),i=this.getAttribute("cpu");i||(i="");let a=this.getAttribute("addr");a||(a="0");let c=`
  <div style="background-color:#808080;border-radius:5px;box-sizing:border-box;padding:5px">
  <textarea id="rasm2-input-`+this.id+'" style="font-family:monospace;background-color:black;color:white;box-sizing:border-box;width:98%;padding:5px;height:6em;margin:5px;border-radius:5px;resize:none">'+r+`</textarea>
  <div id="rasm2-orig-`+this.id+'" style="visibility:hidden">'+r+`</div>
  <div style="text-align:left; margin:5px">
  <div id="rasm2-arch-`+this.id+'" style="visibility:hidden">'+n+`</div>
  <div id="rasm2-bits-`+this.id+'" style="visibility:hidden">'+s+`</div>
  <div id="rasm2-addr-`+this.id+'" style="visibility:hidden">'+a+`</div>
  <div id="rasm2-cpu-`+this.id+'" style="visibility:hidden">'+i+`</div>
  <button onclick="rasm2wasm.assemble('`+this.id+`')">Assemble</button>
  <button onclick="rasm2wasm.disassemble('`+this.id+`')">Disassemble</button>
  <button onclick="rasm2wasm.listArchs('`+this.id+`')">Archs</button>
  <button onclick="rasm2wasm.reset('`+this.id+`')">Reset</button>
  </div>
<div id="rasm2-shell-`+this.id+`" style="overflow:scroll;margin:5px;display:block;background-color:black;border-radius:5px;color:white;white-space:pre;font-family:monospace"></div>
  </div>
   `,y=new DOMParser().parseFromString(c,"text/html");y.body.firstChild&&this.appendChild(y.body.firstChild)}constructor(){super();let e=document.createElement("div");e.style.padding="10px"}};window.customElements.define("rasm2-wasm",x);var M=class extends HTMLElement{connectedCallback(){E++,this.id="rasm2-wasm-progress";let s=new DOMParser().parseFromString("","text/html");s.body.firstChild&&this.appendChild(s.body.firstChild)}constructor(){super();let e=document.createElement("div");e.style.padding="10px"}};window.customElements.define("rasm2-wasm-progress",M);var{WASI:L}=window.Runno;function W(t){let e=document.getElementById("rasm2-shell-"+t);e.innerHTML="";let n=document.getElementById("rasm2-orig-"+t),s=document.getElementById("rasm2-input-"+t);s.value=n.innerHTML}var d=null;var w=!1;function p(){if(w)return;w=!0,d=fetch("rasm2.wasm?v=5.8.8"),g({received:100,length:100,loading:!1}),w=!1}function j(){R();let t=document.getElementById("rasm2-wasm-progress"),e="";t.innerHTML=e}var R=()=>{};async function b(){try{let{get:t,cancel:e}=S("./");R=e,window.addEventListener("fetch-progress",n=>{g(n.detail)}),window.addEventListener("fetch-finished",n=>{g({received:100,length:100,loading:!1})}),d=await t("radare2.wasm?v=5.8.8")}catch(t){console.error(t)}return p(),!0}function g(t){let e=0|t.received*100/t.length,n=document.getElementById("rasm2-wasm-progress");e===100?n.innerHTML="":n.innerHTML="<button onclick='rasm2wasm.cancel()'>cancel</button> <div style='border:2px solid black;background-color:grey;width:"+e+"px'> rasm2wasm.progress("+e+"%)</div>"}async function q(t){d==null&&await b(),div=document.getElementById("rasm2-shell-"+t),div.innerHTML="";let e=L.start(d,{args:["rasm2","-L"],env:{SOME_KEY:"some value"},stdout:n=>{div.innerHTML+=n},stderr:n=>{console.error("stderr",n),div.innerHTML+=n}});p()}async function G(t){d==null&&await b(),div=document.getElementById("rasm2-shell-"+t),div.innerHTML="";let e=document.getElementById("rasm2-arch-"+t).innerHTML,n=document.getElementById("rasm2-bits-"+t).innerHTML,s=document.getElementById("rasm2-addr-"+t).innerHTML,r=document.getElementById("rasm2-cpu-"+t).innerHTML,i=document.getElementById("rasm2-input-"+t).value;n||(n=64),s||(s=0);let a=[];r?a=["rasm2","-a",e,"-b",n,"-c",r,"-s",s,i]:a=["rasm2","-a",e,"-b",n,"-s",s,i];let c=L.start(d,{args:a,env:{SOME_KEY:"some value"},stdout:l=>{div.innerHTML+=l},stderr:l=>{console.error("stderr",l),div.innerHTML+=l}});p()}async function J(t){d==null&&await b(),div=document.getElementById("rasm2-shell-"+t),div.innerHTML="";let e=document.getElementById("rasm2-arch-"+t).innerHTML,n=document.getElementById("rasm2-bits-"+t).innerHTML,s=document.getElementById("rasm2-addr-"+t).innerHTML,r=document.getElementById("rasm2-cpu-"+t).innerHTML,i=document.getElementById("rasm2-input-"+t).value;n||(n=64),s||(s=0);let a=[];r?a=["rasm2","-a",e,"-b",n,"-c",r,"-s",s,"-D",i]:a=["rasm2","-a",e,"-b",n,"-s",s,"-D",i];let c=L.start(d,{args:a,env:{SOME_KEY:"some value"},stdout:l=>{div.innerHTML+=l},stderr:l=>{console.error("stderr",l),div.innerHTML+=l}});p()}return Y(N);})();
